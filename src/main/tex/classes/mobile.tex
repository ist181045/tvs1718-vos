% Copyright 2018 Francisca Cambra, Rui Ventura
%
% Permission is hereby granted, free of charge, to any person obtaining a copy
% of this software and associated documentation files (the "Software"), to deal
% in the Software without restriction, including without limitation the rights
% to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
% copies of the Software, and to permit persons to whom the Software is
% furnished to do so, subject to the following conditions:
%
% The above copyright notice and this permission notice shall be included in all
% copies or substantial portions of the Software.
%
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
% AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
% LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
% OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
% SOFTWARE.
\subsection{\texttt{Mobile} class}
\label{sec:classes.mobile}
A mobile phone can make and receive calls and send and receive texts. A mobile
phone can be turned on or off (and in this case it cannot make calls, send texts
and receive calls nor texts). It has two modes (\textit{friend} and
\textit{silent}) that can be enabled or disabled.

\subsubsection{Test Pattern -- Modal Class Test}
\label{sec:classes.mobile.pattern}

\subsubsection{Finite State Machine}
\label{sec:classes.mobile.fsm}
\begin{figure}[ht]
  \centering
  \begin{tikzpicture}[->,>=stealth',align=left,node distance=3cm]
    \tikzset{
      every state/.style={
        thick,
        rectangle,
        font=\normalsize\tt,
        initial text=new},
      every node/.style={
        font=\scriptsize\tt}}
    \node[state,name=off,initial]{Off};
    \node[state,name=on,right of=off]{On};
    \node[state,name=both,align=center,right of=on,node distance=6cm]{Both};
    \node[state,name=friend,above of=both]{Friend};
    \node[state,name=silent,below of=both]{Silent};

    \draw ($(off.north) - (2mm,0)$) -- ++(0,4mm) -- node[above]{getStatus()}
      ++(4mm,0) -- ++(0,-4mm);
    \draw ($(off.north east) - (0,2mm)$) -- node[above]{turnOn()}
      ($(on.north west) - (0,2mm)$);
    \draw[<-] ($(off.south east) + (0,2mm)$) -- node[below]{turnOff()}
      ($(on.south west) + (0,2mm)$);
    
    \draw ($(on.east) - (0,2mm)$) -- ++(4mm,0) -- node[right]{getStatus()}
      ++(0,4mm) -- ++(-4mm,0);
    \draw ($(on.north west) + (2mm,0)$) |- node[above,pos=.65]
      {[m=true]\\setFriendMode(m)} ($(friend.north west) - (0,2mm)$);
    \draw[<-] ($(on.north east) - (2mm,0)$) |- node[below,pos=.65]
      {[m=false]\\setFriendMode(m)} ($(friend.south west) + (0,2mm)$);
    
    \draw ($(friend.south west) + (4mm,0)$) -- node[align=right,left]
      {[m=true]\\setFriendMode(m)} ($(both.north west) + (2mm,0)$);
    \draw[<-] ($(friend.south east) - (4mm,0)$) -- node[right]
      {[m=false]\\setFriendMode(m)} ($(both.north east) - (2mm,0)$);
    
    \draw ($(friend.east) - (0,2mm)$) -- ++(4mm,0) -- node[right]{getStatus()}
      ++(0,4mm) -- ++(-4mm,0);
    \draw ($(both.east) - (0,2mm)$) -- ++(4mm,0) -- node[right]{getStatus()}
      ++(0,4mm) -- ++(-4mm,0);
    \draw ($(silent.east) - (0,2mm)$) -- ++(4mm,0) -- node[right]{getStatus()}
      ++(0,4mm) -- ++(-4mm,0);
    
    \draw ($(silent.north west) + (4mm,0)$) -- node[align=right,left]
      {[m=true]\\setSilentMode(m)} ($(both.south west) + (2mm,0)$);
    \draw[<-] ($(silent.north east) - (4mm,0)$) -- node[right]
      {[m=false]\\setSilentMode(m)} ($(both.south east) - (2mm,0)$);
    
    \draw ($(on.south west) + (2mm,0)$) |- node[below,pos=.65]
      {[m=true]\\setSilentMode(m)} ($(silent.south west) + (0,2mm)$);
    \draw[<-] ($(on.south east) - (2mm,0)$) |- node[above,pos=.65]
      {[m=false]\\setSilentMode(m)} ($(silent.north west) - (0,2mm)$);
  \end{tikzpicture}
  \caption[\texttt{Mobile} class fsm]
    {\texttt{Mobile} class state machine, representing the class' states and
      transitions between them}
  \label{fig:classes.mobile.fsm}
\end{figure}
\newpage

\subsubsection{Transition Tree}
\label{sec:classes.mobile.ttree}
\begin{sidewaysfigure}[H]
  \begin{forest} transition tree
    [,draw=none
      [\tt Off,transition root
        [\tt Off,edge label={node[above,align=left,pos=.66]{\scriptsize\tt getStatus()}}]
        [\tt On,edge label={node[above,align=left,pos=.62]{\scriptsize\tt turnOn()}}
          [\tt Silent,edge label={node[above,align=left,pos=.73]
            {\texttt{\scriptsize [m=true]}\\\texttt{\scriptsize setSilentMode(m)}}}
            [\tt Both,edge label={node[above,align=left,pos=.73]
                {\texttt{\scriptsize [m=true]}\\\texttt{\scriptsize setFriendMode(m)}}}
              [\tt Both,edge label={node[above,align=left,pos=.67]{\scriptsize\tt getStatus()}}]
              [\tt Friend,edge label={node[above,align=left,pos=.73]
                {\texttt{\scriptsize [m=false]}\\\texttt{\scriptsize setFriendMode(m)}}}]
              [\tt Silent,edge label={node[above,align=left,pos=.73]
                {\texttt{\scriptsize [m=false]}\\\texttt{\scriptsize setFriendMode(m)}}}]
              [\tt Off,edge label={node[above,align=left,pos=.64]{\scriptsize\tt turnOff()}}]
            ]
            [\tt Silent,edge label={node[above,align=left,pos=.68]{\scriptsize\tt getStatus()}}]
            [\tt Off,edge label={node[above,align=left,pos=.64]{\scriptsize\tt turnOff()}}]
            [\tt On,edge label={node[above,align=left,pos=.73]
              {\texttt{\scriptsize [m=false]}\\\texttt{\scriptsize setSilentMode(m)}}}]
          ]
          [\tt Friend,edge label={node[above,align=left,pos=.73]
              {\texttt{\scriptsize [m=true]}\\\texttt{\scriptsize setFriendMode(m)}}}
            [\tt Both,edge label={node[above,align=left,pos=.73]
              {\texttt{\scriptsize [m=true]}\\\texttt{\scriptsize setSilentMode(m)}}}
              [\tt Both,edge label={node[above,align=left,pos=.67]{\scriptsize\tt getStatus()}}]
              [\tt Friend,edge label={node[above,align=left,pos=.73]
                {\texttt{\scriptsize [m=false]}\\\texttt{\scriptsize setFriendMode(m)}}}]
              [\tt Silent,edge label={node[above,align=left,pos=.73]
                {\texttt{\scriptsize [m=true]}\\\texttt{\scriptsize setFriendMode(m)}}}]
              [\tt Off,edge label={node[above,align=left,pos=.64]{\scriptsize\tt turnOff()}}]
            ]
            [\tt Friend,edge label={node[above,align=left,pos=.68]{\scriptsize\tt getStatus()}}]
            [\tt Off,edge label={node[above,align=left,pos=.64]{\scriptsize\tt turnOff()}}]
            [\tt On,edge label={node[above,align=left,pos=.72]
              {\texttt{\scriptsize [m=false]}\\\texttt{\scriptsize setFriendMode(m)}}}]
          ]
          [\tt Off,edge label={node[above,align=left,pos=.63]{\scriptsize\tt turnOff()}}]
          [\tt On,edge label={node[above,align=left,pos=.66]{\scriptsize\tt getStatus()}}]
        ]
      ]
    ]
  \end{forest}
  \caption{\texttt{Mobile} class transition tree}
  \label{fig:classes.mobile.ttree}
\end{sidewaysfigure}
\clearpage